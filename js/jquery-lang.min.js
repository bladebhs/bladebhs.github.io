!function(t){"use strict";if("function"==typeof define&&define.amd)define(["jquery","Cookies"],t);else if("object"==typeof exports)module.exports=t();else{var e=window.Lang,n=window.Lang=t(jQuery,"undefined"!=typeof Cookies?Cookies:void 0);n.noConflict=function(){return window.Lang=e,n}}}(function(l,f){var t=function(){this._fireEvents=!0,this._dynamic={}};return t.prototype.init=function(t){var e,n,a,i,o=this;(t=t||{}).cookie=t.cookie||{},n=t.defaultLang,a=t.currentLang,i=t.allowCookieOverride,this.cookieName=t.cookie.name||"langCookie",this.cookieExpiry=t.cookie.expiry||365,this.cookiePath=t.cookie.path||"/",this._mutationCopies={append:l.fn.append,appendTo:l.fn.appendTo,prepend:l.fn.prepend,before:l.fn.before,after:l.fn.after,html:l.fn.html},l.fn.append=function(){return o._mutation(this,"append",arguments)},l.fn.appendTo=function(){return o._mutation(this,"appendTo",arguments)},l.fn.prepend=function(){return o._mutation(this,"prepend",arguments)},l.fn.before=function(){return o._mutation(this,"before",arguments)},l.fn.after=function(){return o._mutation(this,"after",arguments)},l.fn.html=function(){return o._mutation(this,"html",arguments)},this.defaultLang=n||"en",this.currentLang=n||"en",!i&&a||void 0===f||(e=f.get(this.cookieName))&&(a=e),l(function(){o._start(),a&&a!==o.defaultLang&&o.change(a)})},t.prototype.pack={},t.prototype.attrList=["title","alt","placeholder","href"],t.prototype.dynamic=function(t,e){void 0!==t&&void 0!==e&&(this._dynamic[t]=e)},t.prototype.loadPack=function(i,o){var r=this;if(!i||!r._dynamic[i])throw"Cannot load language pack, no file path specified!";l.ajax({dataType:"json",url:r._dynamic[i],success:function(t){if(r.pack[i]=t,r.pack[i].regex){var e,n,a=r.pack[i].regex;for(n=0;n<a.length;n++)2===(e=a[n]).length?e[0]=new RegExp(e[0]):3===e.length&&(e[0]=new RegExp(e[0],e[1]),e.splice(1,1))}o&&o(!1,i,r._dynamic[i])},error:function(){throw o&&o(!0,i,r._dynamic[i]),"Error loading language pack"+r._dynamic[i]}})},t.prototype._start=function(t){for(var e,n=void 0!==t?l(t).find("[lang]"):l(":not(html)[lang]"),a=n.length;a--;)e=l(n[a]),this._processElement(e)},t.prototype._processElement=function(t){t.attr("lang")===this.defaultLang&&(this._storeAttribs(t),this._storeContent(t))},t.prototype._storeAttribs=function(t){var e,n,a;for(e=0;e<this.attrList.length;e++)n=this.attrList[e],t.attr(n)&&((a=t.data("lang-attr")||{})[n]=t.attr(n),t.data("lang-attr",a))},t.prototype._storeContent=function(t){if(t.is("input"))switch(t.attr("type")){case"button":case"submit":case"hidden":case"reset":t.data("lang-val",t.val())}else if(t.is("img"))t.data("lang-src",t.attr("src"));else{var e=this._getTextNodes(t);e&&t.data("lang-text",e)}},t.prototype._getTextNodes=function(t){var e=t.contents(),n=[],a={};Array.prototype.map;return l.each(e,function(t,e){3===e.nodeType&&(a={node:e,langDefaultText:e.data},n.push(a))}),1==e.length&&(n[0].langToken=t.data("langToken")),n},t.prototype._setTextNodes=function(t,e,n){var a,i,o,r,s=n!==this.defaultLang;for(a=0;a<e.length;a++)if(i=e[a],s){if(o=i.langToken||l.trim(i.langDefaultText))if(r=this.translate(o,n),/<[^>]+>/g.test(r))t.context.innerHTML=r;else if(r)try{i.node.data=i.node.data.split(l.trim(i.node.data)).join(r)}catch(t){}else console&&console.log&&console.log('Translation for "'+o+'" not found!')}else try{i.node.data=i.langDefaultText}catch(t){}},t.prototype._translateAttribs=function(t,e){var n,a,i=t.data("lang-attr")||{};for(n in i)i.hasOwnProperty(n)&&t.attr(n)&&(e!==this.defaultLang?(a=this.translate(i[n],e))&&t.attr(n,a):t.attr(n,i[n]))},t.prototype._translateContent=function(t,e){var n,a,i=e!==this.defaultLang;if(t.is("input"))switch(t.attr("type")){case"button":case"submit":case"hidden":case"reset":i?(n=this.translate(t.data("lang-val"),e))&&t.val(n):t.val(t.data("lang-val"))}else t.is("img")?i?(n=this.translate(t.data("lang-src"),e))&&t.attr("src",n):t.attr("src",t.data("lang-src")):(a=t.data("lang-text"))&&this._setTextNodes(t,a,e)},t.prototype.change=function(a,i,o){var r=this;if(a!==this.defaultLang&&!this.pack[a]&&!this._dynamic[a])throw o&&o("No language pack defined for: "+a,a,i),'Attempt to change language to "'+a+'" but no language pack for that language is loaded!';if(a!==this.defaultLang){if(!this.pack[a]&&this._dynamic[a])return void this.loadPack(a,function(t,e,n){t?o&&o("Language pack could not load from: "+n,a,i):r.change.call(r,a,i,o)});if(!this.pack[a]&&!this._dynamic[a])throw o&&o("Language pack not defined for: "+a,a,i),"Could not change language to "+a+" because no language pack for this language exists!"}var t=!1,e=this.currentLang;this.currentLang!=a&&(this.beforeUpdate(e,a),t=!0),this.currentLang=a;for(var n,s=void 0!==i?l(i).find("[lang]"):l(":not(html)[lang]"),c=s.length;c--;)(n=l(s[c])).attr("lang")!==a&&this._translateElement(n,a);t&&this.afterUpdate(e,a),void 0!==f&&f.set(r.cookieName,a,{expires:r.cookieExpiry,path:r.cookiePath}),o&&o(!1,a,i)},t.prototype._translateElement=function(t,e){this._translateAttribs(t,e),"false"!=t.attr("data-lang-content")&&this._translateContent(t,e),t.attr("lang",e)},t.prototype.translate=function(t,e){if(e=e||this.currentLang,this.pack[e]){var n="";return e!=this.defaultLang?((n=this.pack[e].token[t])||(n=this._regexMatch(t,e)),n||console&&console.log&&console.log('Translation for "'+t+'" not found in language pack: '+e),n||t):t}return t},t.prototype._regexMatch=function(t,e){var n,a,i,o,r;if(n=this.pack[e].regex)for(a=n.length,i=0;i<a;i++)if((r=(o=n[i])[0].exec(t))&&r[0])return t.split(r[0]).join(o[1]);return""},t.prototype.beforeUpdate=function(t,e){this._fireEvents&&l(this).triggerHandler("beforeUpdate",[t,e,this.pack[t],this.pack[e]])},t.prototype.afterUpdate=function(t,e){this._fireEvents&&l(this).triggerHandler("afterUpdate",[t,e,this.pack[t],this.pack[e]])},t.prototype.refresh=function(){this._fireEvents=!1,this.change(this.currentLang),this._fireEvents=!0},t.prototype._mutation=function(t,e,n){var a=this._mutationCopies[e].apply(t,n),i=this.currentLang,o=l(t);return o.attr("lang")&&(this._fireEvents=!1,this._translateElement(o,this.defaultLang),this.change(this.defaultLang,o),this.currentLang=i,this._processElement(o),this._translateElement(o,this.currentLang)),this._start(o),this.change(this.currentLang,o),this._fireEvents=!0,a},t});